(function(){var s={together:!1,errShow:"alert",errBox:"error_strings",errPar:"li",timely:!1},g={extend:function(d,c){var a,b={};for(a in d)b[a]=c[a]?c[a]:d[a];return b},each:function(d,c){var a;if(d.constructor===Array)for(var b=0;b<d.length;b+=1){a=c(b,d[b]);if(a=="break")return!1}else if(typeof d=="object")for(var b in d){a=c(b,d[b]);if(a=="break")return!1}},inArray:function(d,c){var a=0,b=c.length,f={};for(;a<b;a+=1)f[c[a]]=!0;return f[d]},hasClass:function(d,c){var a=new RegExp("(\\s|^)"+c+"(\\s|$)");return d.className.match(a)},insertAfter:function(d,c){var a=c.parentNode;a.lastChild==c?c.appendChild(d):a.insertBefore(d,c.nextSibling)},getParent:function(d,c){return d.parentNode.tagName==c?d.parentNode:arguments.callee(d.parentNode,c)},getErrBox:function(d,c,a){var b=d.getElementsByTagName(c),f=0,h=b.length,k;if(h>0)for(;f<h;f+=1)if(g.hasClass(b[f],a))return k=b[f],!1;if(k)return k;var i=document.createElement(c);return i.className=a,d.appendChild(i),i},addMsg:function(d,c){d.style.display="inline-block",d.innerHTML=c},bind:function(){if(window.addEventListener)return function(e,t,n,r){e.bindFn={},e.addEventListener(t,function(){n(),e.bindFn[t]=e.bindFn[t]||[],e.bindFn[t].push(arguments.callee)},r)};if(window.attachEvent)return function(e,t,n,r){e.bindFn={},e.attachEvent("on"+t,function(){n(),e.bindFn[t]=e.bindFn[t]||[],e.bindFn[t].push(arguments.callee)})}}(),isEmpty:function(d){return d=d.replace(/(^\s*)|(\s*$)/g,""),d.length==0?!0:!1}},p=function(d,c){if(!(this instanceof p))return new p(d,c);this.options=g.extend(s,c),this.formobj=document.forms[d];if(!this.formobj)return alert("找不到表单"+d),!1;this.init()};p.prototype.init=function(d){var c=this,a=this.formobj;d?(c.hideError(),c.options=g.extend(s,d)):(a.oldSubmit=null,a.onsubmit&&(a.oldSubmit=a.onsubmit,a.onsubmit=null),a.onsubmit=function(){return c.checkForm()?(c.showError(),!1):a.oldSubmit()},c.ruleData=[],c.errObjList={},c.errorHash={},c.errorArray=[],c.errorFnArray=[])},p.prototype.addValidation=function(){var h=this,k,i,m,j,l,q={};arguments[0].constructor===Array&&g.each(arguments[0],function(b,f){j=f[0],l=h.formobj[j];if(!l)return"break";k=f[1].search("="),k>=0?(i=f[1].substring(0,k),m=f[1].substr(k+1),i!="regex"&&(m=isNaN(m)?m:parseInt(m),/^('|")\w+/.test(m)&&(m=m.replace(/^('|")|('|")$/g,"").split("|")))):(i=f[1],m=undefined),q={name:j,obj:l,rule:i,ruleExt:m!==!1?m:"",msg:f[2]||""},h.ruleData.push(q),h.options.timely&&function(a){l.length>0?l.tagName=="SELECT"?function(){g.bind(l,"change",function(){h.checkSingle(a,!0),h.checkError(a)})}():function(){for(var c=0;c<l.length;c+=1)(function(d){g.bind(l[d],"click",function(){h.checkSingle(a,!0),h.checkError(a)})})(c)}():g.bind(l,"blur",function(){h.checkSingle(a,!0),h.checkError(a)})}(q)})},p.prototype.checkForm=function(){var a=this;return a.errorHash={},a.errorArray=[],a.hideError(),g.each(a.ruleData,function(d,c){if(a.options.together)a.checkSingle(c);else{if(!(a.errorArray.length<1))return"break";a.checkSingle(c)}}),a.errorArray.length>0?!0:!1},p.prototype.checkSingle=function(a,b){var f=this;if(!v.call(f,a)){if(!f.errorHash[a.name]){var h=f.errorArray.push(a);f.errorHash[a.name]=h}}else{var k=!1,h=f.errorHash[a.name];b&&h>0&&g.each(f.errorArray,function(d,c){if(c["name"]==a.name&&f.errorArray[d]["rule"]==a.rule)return f.errorArray.splice(d,1),f.errorHash[a.name]=!1,!1})}},p.prototype.showError=function(){var a=this,b=[],f;if(typeof a.options.errShow=="function")a.options.errShow(a.errorArray);else switch(a.options.errShow){case"alert":case"multiple":g.each(a.errorArray,function(d,c){typeof c.msg=="string"?b.push(c.msg):typeof c.msg=="function"&&c.msg()}),a.options.errShow=="alert"?b.length>0&&alert(b.join("\n")):a.showErrorBox(a.formobj,b.join("<br/>"));break;case"single":g.each(a.errorArray,function(d,c){typeof c.msg=="string"?a.showErrorSingle(c):typeof c.msg=="function"&&c.msg()})}},p.prototype.showErrorSingle=function(d){var c=this,a=d.obj,b=d.msg,f=d.name;c.errObjList[f]||(a.tagName!="SELECT"&&a.length&&(a=a[a.length-1]),a=g.getParent(a,c.options.errPar.toUpperCase()),c.errObjList[f]=g.getErrBox(a,"span",c.options.errBox)),typeof b=="string"?g.addMsg(c.errObjList[f],b):typeof b=="function"&&b()},p.prototype.showErrorBox=function(d,c){var a=this,b=d.parentNode.getElementsByTagName("div");if(a.errGlobalObj)a.errGlobalObj.innerHTML=c,a.errGlobalObj.style.display="block";else{for(var f=0;f<b.length;f+=1)if(g.hasClass(b[f],a.options.errBox))return a.errGlobalObj=b[f],g.addMsg(a.errGlobalObj,c),!1;a.errGlobalObj||(a.errGlobalObj=document.createElement("div"),a.errGlobalObj.className=a.options.errBox,a.errGlobalObj.innerHTML=c,a.errGlobalObj.style.display="block",g.insertAfter(a.errGlobalObj,d))}},p.prototype.checkError=function(a){var b=this,f=b.errorHash[a.name];b.errGlobalObj&&(b.errGlobalObj.style.display="none"),f>0?g.each(b.errorArray,function(d,c){if(c["name"]==a.name&&b.errorArray[d]["rule"]==a.rule)return b.showErrorSingle(b.errorArray[d]),!1}):b.hideError(a.name)},p.prototype.hideError=function(a){var b=this;if(a)return b.errObjList[a]&&(b.errObjList[a].style.display="none"),!1;b.errGlobalObj&&(b.errGlobalObj.style.display="none"),b.errObjList&&g.each(b.errObjList,function(d,c){c.style.display="none"})};var v=function(b){var f=b.rule;switch(f){case"regex":return eval(b.ruleExt).test(b.obj.value);case"required":return g.isEmpty(b.obj.value)?!1:!0;case"maxlength":return g.isEmpty(b.obj.value)?!0:b.obj.value.length<b.ruleExt;case"minlength":return g.isEmpty(b.obj.value)?!0:b.obj.value.length>b.ruleExt;case"number":return g.isEmpty(b.obj.value)?!0:/^[\d]+$/.test(b.obj.value);case"alpha":return g.isEmpty(b.obj.value)?!0:/^[A-Za-z]+$/.test(b.obj.value);case"string":return g.isEmpty(b.obj.value)?!0:/^\\w+$/.test(b.obj.value);case"email":return g.isEmpty(b.obj.value)?!0:/\w+((-w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+/.test(b.obj.value);case"telphone":return g.isEmpty(b.obj.value)?!0:/^[+]{0,1}(\d){1,3}[ ]?([-]?((\d)|[ ]){1,12})+$/.test(b.obj.value);case"mobile":return g.isEmpty(b.obj.value)?!0:/^0?1(3|5|8)\d{9}$/.test(b.obj.value);case"lessthan":case"greaterthan":var h=typeof b.ruleExt=="number"?b.ruleExt:parseInt(this.formobj[b.ruleExt].value);return f=="lessthan"?parseInt(b.obj.value)<h:parseInt(b.obj.value)>h;case"equal":case"unequal":var k=b.obj.value,i=b.ruleExt,m=this;return typeof i=="number"?function(){return f=="equal"?parseInt(k)==i:parseInt(k)!=i}():function(){return i.constructor===Array?f=="equal"?g.inArray(k,i):!g.inArray(k,i):f=="equal"?k==m.formobj[i].value:k!=m.formobj[i].value}();case"notselect":return b.obj.tagName=="SELECT"?function(){var d=b.obj.selectedIndex;return b.obj.options[d].value!=b.ruleExt}():function(){var d=b.obj,c=!0;if(d.length){if(b.ruleExt&&b.ruleExt.constructor===Array){q=b.ruleExt.length;for(var a=0;a<d.length;a+=1)if(d[a].checked==1&&g.inArray(d[a].value,b.ruleExt))return c=!1,!1}else for(var a=0;a<d.length;a+=1)if(d[a].checked==1){if(b.ruleExt===undefined)return c=!1,!1;if(d[a].value==b.ruleExt)return c=!1,!1}}else d.checked==1&&(c=!1);return c}();case"shouldselect":var j=b.obj,l=!1,q=0,u=0;if(j.length)if(b.ruleExt&&b.ruleExt.constructor===Array){q=b.ruleExt.length;for(var o=0;o<j.length;o+=1)j[o].checked==1&&g.inArray(j[o].value,b.ruleExt)&&(u+=1);l=q===u?!0:!1}else for(var o=0;o<j.length;o+=1)j[o].checked==1&&(b.ruleExt===undefined?l=!0:j[o].value==b.ruleExt&&(l=!0));else j.checked==1&&(l=!0);return l;case"minselect":case"maxselect":var j=b.obj,q=0;if(j.length)for(var o=0;o<j.length;o+=1)j[o].checked==1&&(q+=1);else j.checked==1&&(q+=1);return f=="minselect"?q>=b.ruleExt:q<=b.ruleExt;default:return!1}};window.Validator=p})()
(function(){var u={together:!1,errShow:"alert",errBox:"error_strings",errPar:"li",timely:!1},g={extend:function(d,c){var a,b={};for(a in d)b[a]=c[a]?c[a]:d[a];return b},each:function(d,c){var a;if(d.constructor===Array)for(var b=0;b<d.length;b+=1){a=c(b,d[b]);if(a=="break")return!1}else if(typeof d=="object")for(var b in d){a=c(b,d[b]);if(a=="break")return!1}},inArray:function(d,c){var a=0,b=c.length,f={};for(;a<b;a+=1)f[c[a]]=!0;return f[d]},hasClass:function(d,c){var a=new RegExp("(\\s|^)"+c+"(\\s|$)");return d.className.match(a)},insertAfter:function(d,c){var a=c.parentNode;a.lastChild==c?c.appendChild(d):a.insertBefore(d,c.nextSibling)},getParent:function(d,c){return d.parentNode.tagName==c?d.parentNode:arguments.callee(d.parentNode,c)},getErrBox:function(d,c,a){var b=d.getElementsByTagName(c),f=0,j=b.length,o;if(j>0)for(;f<j;f+=1)if(g.hasClass(b[f],a))return o=b[f],!1;if(o)return o;var k=document.createElement(c);return k.className=a,d.appendChild(k),k},addMsg:function(d,c){d.style.display="inline-block",d.innerHTML=c},bind:function(){if(window.addEventListener)return function(e,t,n,r){e.bindFn={},e.addEventListener(t,function(){n(),e.bindFn[t]=e.bindFn[t]||[],e.bindFn[t].push(arguments.callee)},r)};if(window.attachEvent)return function(e,t,n,r){e.bindFn={},e.attachEvent("on"+t,function(){n(),e.bindFn[t]=e.bindFn[t]||[],e.bindFn[t].push(arguments.callee)})}}(),isEmpty:function(d){return d=d.replace(/(^\s*)|(\s*$)/g,""),d.length==0?!0:!1}},l=function(d,c){if(!(this instanceof l))return new l(d,c);this.options=g.extend(u,c),this.formobj=document.forms[d];if(!this.formobj)return alert("找不到表单"+d),!1;this.init()};l.fn=l.prototype,l.fn.init=function(d){var c=this,a=this.formobj;d?(c.hideError(),c.options=g.extend(u,d)):(a.oldSubmit=null,a.onsubmit&&(a.oldSubmit=a.onsubmit,a.onsubmit=null),a.onsubmit=function(){return c.checkForm()?(c.showError(),!1):a.oldSubmit()},c.ruleData=[],c.errObjList={},c.errorHash={},c.errorArray=[],c.errorFnArray=[])},l.fn.addValidation=function(){var j=this,o,k,i,s,h,p={};arguments[0].constructor===Array&&g.each(arguments[0],function(b,f){s=f[0],h=j.formobj[s];if(!h)return"break";o=f[1].search("="),o>=0?(k=f[1].substring(0,o),i=f[1].substr(o+1),k!="regex"&&(i=isNaN(i)?i:parseInt(i),/^('|")\w+/.test(i)&&(i=i.replace(/^('|")|('|")$/g,"").split("|")))):(k=f[1],i=undefined),p={name:s,obj:h,rule:k,ruleExt:i!==!1?i:"",msg:f[2]||""},j.ruleData.push(p),j.options.timely&&function(a){h.length>0?h.tagName=="SELECT"?function(){g.bind(h,"change",function(){j.checkSingle(a,!0),j.checkError(a)})}():function(){for(var c=0;c<h.length;c+=1)(function(d){g.bind(h[d],"click",function(){j.checkSingle(a,!0),j.checkError(a)})})(c)}():g.bind(h,"blur",function(){j.checkSingle(a,!0),j.checkError(a)})}(p)})},l.fn.checkForm=function(){var a=this;return a.errorHash={},a.errorArray=[],a.hideError(),g.each(a.ruleData,function(d,c){if(a.options.together)a.checkSingle(c);else{if(!(a.errorArray.length<1))return"break";a.checkSingle(c)}}),a.errorArray.length>0?!0:!1},l.fn.checkSingle=function(a,b){var f=this;if(!w.call(f,a)){if(!f.errorHash[a.name]){var j=f.errorArray.push(a);f.errorHash[a.name]=j}}else{var o=!1,j=f.errorHash[a.name];b&&j>0&&g.each(f.errorArray,function(d,c){if(c["name"]==a.name&&f.errorArray[d]["rule"]==a.rule)return f.errorArray.splice(d,1),f.errorHash[a.name]=!1,!1})}},l.fn.showError=function(){var a=this,b=[],f;if(typeof a.options.errShow=="function")a.options.errShow(a.errorArray);else switch(a.options.errShow){case"alert":case"multiple":g.each(a.errorArray,function(d,c){typeof c.msg=="string"?b.push(c.msg):typeof c.msg=="function"&&c.msg()}),a.options.errShow=="alert"?b.length>0&&alert(b.join("\n")):a.showErrorBox(a.formobj,b.join("<br/>"));break;case"single":g.each(a.errorArray,function(d,c){typeof c.msg=="string"?a.showErrorSingle(c):typeof c.msg=="function"&&c.msg()})}},l.fn.showErrorSingle=function(d){var c=this,a=d.obj,b=d.msg,f=d.name;c.errObjList[f]||(a.tagName!="SELECT"&&a.length&&(a=a[a.length-1]),a=g.getParent(a,c.options.errPar.toUpperCase()),c.errObjList[f]=g.getErrBox(a,"span",c.options.errBox)),typeof b=="string"?g.addMsg(c.errObjList[f],b):typeof b=="function"&&b()},l.fn.showErrorBox=function(d,c){var a=this,b=d.parentNode.getElementsByTagName("div");if(a.errGlobalObj)a.errGlobalObj.innerHTML=c,a.errGlobalObj.style.display="block";else{for(var f=0;f<b.length;f+=1)if(g.hasClass(b[f],a.options.errBox))return a.errGlobalObj=b[f],g.addMsg(a.errGlobalObj,c),!1;a.errGlobalObj||(a.errGlobalObj=document.createElement("div"),a.errGlobalObj.className=a.options.errBox,a.errGlobalObj.innerHTML=c,a.errGlobalObj.style.display="block",g.insertAfter(a.errGlobalObj,d))}},l.fn.checkError=function(a){var b=this,f=b.errorHash[a.name];b.errGlobalObj&&(b.errGlobalObj.style.display="none"),f>0?g.each(b.errorArray,function(d,c){if(c["name"]==a.name&&b.errorArray[d]["rule"]==a.rule)return b.showErrorSingle(b.errorArray[d]),!1}):b.hideError(a.name)},l.fn.hideError=function(a){var b=this;if(a)return b.errObjList[a]&&(b.errObjList[a].style.display="none"),!1;b.errGlobalObj&&(b.errGlobalObj.style.display="none"),b.errObjList&&g.each(b.errObjList,function(d,c){c.style.display="none"})};var w=function(b){var f=b.rule;switch(f){case"regex":return eval(b.ruleExt).test(b.obj.value);case"required":return g.isEmpty(b.obj.value)?!1:!0;case"maxlength":return g.isEmpty(b.obj.value)?!0:b.obj.value.length<b.ruleExt;case"minlength":return g.isEmpty(b.obj.value)?!0:b.obj.value.length>b.ruleExt;case"number":return g.isEmpty(b.obj.value)?!0:/^[\d]+$/.test(b.obj.value);case"alpha":return g.isEmpty(b.obj.value)?!0:/^[A-Za-z]+$/.test(b.obj.value);case"string":return g.isEmpty(b.obj.value)?!0:/^\\w+$/.test(b.obj.value);case"email":return g.isEmpty(b.obj.value)?!0:/\w+((-w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+/.test(b.obj.value);case"telphone":return g.isEmpty(b.obj.value)?!0:/^[+]{0,1}(\d){1,3}[ ]?([-]?((\d)|[ ]){1,12})+$/.test(b.obj.value);case"mobile":return g.isEmpty(b.obj.value)?!0:/^0?1(3|5|8)\d{9}$/.test(b.obj.value);case"url":var j=/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;return j.test(b.obj.value);case"lessthan":case"greaterthan":var o=typeof b.ruleExt=="number"?b.ruleExt:parseInt(this.formobj[b.ruleExt].value);return f=="lessthan"?parseInt(b.obj.value)<o:parseInt(b.obj.value)>o;case"equal":case"unequal":var k=b.obj.value,i=b.ruleExt,s=this;return typeof i=="number"?function(){return f=="equal"?parseInt(k)==i:parseInt(k)!=i}():function(){return i.constructor===Array?f=="equal"?g.inArray(k,i):!g.inArray(k,i):f=="equal"?k==s.formobj[i].value:k!=s.formobj[i].value}();case"notselect":return b.obj.tagName=="SELECT"?function(){var d=b.obj.selectedIndex;return b.obj.options[d].value!=b.ruleExt}():function(){var d=b.obj,c=!0;if(d.length){if(b.ruleExt&&b.ruleExt.constructor===Array){q=b.ruleExt.length;for(var a=0;a<d.length;a+=1)if(d[a].checked==1&&g.inArray(d[a].value,b.ruleExt))return c=!1,!1}else for(var a=0;a<d.length;a+=1)if(d[a].checked==1){if(b.ruleExt===undefined)return c=!1,!1;if(d[a].value==b.ruleExt)return c=!1,!1}}else d.checked==1&&(c=!1);return c}();case"shouldselect":var h=b.obj,p=!1,q=0,v=0;if(h.length)if(b.ruleExt&&b.ruleExt.constructor===Array){q=b.ruleExt.length;for(var m=0;m<h.length;m+=1)h[m].checked==1&&g.inArray(h[m].value,b.ruleExt)&&(v+=1);p=q===v?!0:!1}else for(var m=0;m<h.length;m+=1)h[m].checked==1&&(b.ruleExt===undefined?p=!0:h[m].value==b.ruleExt&&(p=!0));else h.checked==1&&(p=!0);return p;case"minselect":case"maxselect":var h=b.obj,q=0;if(h.length)for(var m=0;m<h.length;m+=1)h[m].checked==1&&(q+=1);else h.checked==1&&(q+=1);return f=="minselect"?q>=b.ruleExt:q<=b.ruleExt;default:return!1}};window.Validator=l})()
/**
* Form Validator
* Author : ok8008@yeah.net
* Link : https://github.com/liutian1937/Validator
* Version : v4
*/
(function(){var u={together:!1,errShow:"alert",errBox:"error_strings",errPar:"li",timely:!1},g={extend:function(c,d){var a,b={};for(a in c)b[a]=d[a]?d[a]:c[a];return b},each:function(c,d){var a;if(c.constructor===Array)for(var b=0;b<c.length;b+=1){a=d(b,c[b]);if(a===!1)return!1}else if(typeof c=="object")for(var b in c){a=d(b,c[b]);if(a===!1)return!1}},inArray:function(c,d){var a=0,b=d.length,f={};for(;a<b;a+=1)f[d[a]]=!0;return f[c]},hasClass:function(c,d){var a=new RegExp("(\\s|^)"+d+"(\\s|$)");return c.className.match(a)},insertAfter:function(c,d){var a=d.parentNode;a.lastChild==d?d.appendChild(c):a.insertBefore(c,d.nextSibling)},getParent:function(c,d){return c.parentNode.tagName==d?c.parentNode:arguments.callee(c.parentNode,d)},getErrBox:function(c,d,a){var b=c.getElementsByTagName(d),f=0,k=b.length,l;if(k>0)for(;f<k;f+=1)if(g.hasClass(b[f],a))return l=b[f],l;if(l)return l;var h=document.createElement(d);return h.className=a,c.appendChild(h),h},addMsg:function(c,d){c.style.display="inline-block",c.innerHTML=d},bind:function(){if(window.addEventListener)return function(e,t,n,r){e.bindFn=e.bindFn||{},e.bindFn[r]={eventType:t,eventFn:n},e.addEventListener(t,n,!1)};if(window.attachEvent)return function(e,t,n,r){e.bindFn=e.bindFn||{},e.bindFn[r]={eventType:t,eventFn:n},e.attachEvent("on"+t,n)}}(),unbind:function(){if(window.addEventListener)return function(e,t){if(t){if(e.bindFn[t]){var c=e.bindFn[t].eventFn,d=e.bindFn[t].eventType;e.removeEventListener(d,c)}}else{var a;for(a in e.bindFn)e.removeEventListener(e.bindFn[a].eventType,e.bindFn[a].eventFn)}};if(window.attachEvent)return function(e,t){if(t){if(e.bindFn[t]){var c=e.bindFn[t].eventFn,d=e.bindFn[t].eventType;e.detachEvent("on"+d,c)}}else{var a;for(a in e.bindFn)e.detachEvent("on"+e.bindFn[a].eventType,e.bindFn[a].eventFn)}}}(),isEmpty:function(c){return c=c.replace(/(^\s*)|(\s*$)/g,""),c.length==0?!0:!1}},i=function(c,d){if(!(this instanceof i))return new i(c,d);this.options=g.extend(u,d),this.formobj=document.forms[c];if(!this.formobj)return alert("找不到表单"+c),!1;this.init()};i.fn=i.prototype,i.fn.init=function(c){var d=this,a=this.formobj;c?(d.hideError(),d.options=g.extend(u,c)):(a.oldSubmit=null,a.onsubmit&&(a.oldSubmit=a.onsubmit,a.onsubmit=null),a.onsubmit=function(){return d.checkForm()?(d.showError(),!1):a.oldSubmit?a.oldSubmit():!0},d.ruleData=[],d.errObjList={},d.errorHash={},d.errorArray=[],d.errorFnArray=[])},i.fn.addRule=function(a){var b=this;return a.constructor===Array&&(a[0].constructor===Array?g.each(a,function(c,d){b.initRule(d)}):b.initRule(a)),b},i.fn.removeRule=function(c){var d=this,a,b,f=[],k,l;if(c.constructor===Array)if(c[0].constructor===Array)for(var h=0;h<c.length;h+=1)a=c[h][0],b=c[h][1],d.removeRuleFn(a,b);else a=c[0],b=c[1],d.removeRuleFn(a,b);else typeof c=="string"&&d.removeRuleFn(c)},i.fn.removeRuleFn=function(c,d){var a=this;if(d){for(var b=0;b<a.ruleData.length;b+=1)if(a.ruleData[b].name==c&&a.ruleData[b].rule==d)return g.unbind(a.ruleData[b].obj,d),a.ruleData.splice(b,1),!1}else{var b=a.ruleData.length;while(b>0)b-=1,a.ruleData[b].name==c&&(g.unbind(a.ruleData[b].obj),a.ruleData.splice(b,1))}},i.fn.destory=function(){var c=this,d=c.formobj.getElementsByTagName("input"),a=c.formobj.getElementsByTagName("select"),b=c.formobj.getElementsByTagName("textarea");for(var f=0;f<d.length;f+=1)g.unbind(d[f]);for(var f=0;f<a.length;f+=1)g.unbind(a[f]);for(var f=0;f<b.length;f+=1)g.unbind(b[f]);c.formobj.oldSubmit=null,c.formobj.onsubmit=null,c.init()},i.fn.initRule=function(b){var f=this,k,l,h,p,m,j={};p=b[0],m=f.formobj[p];if(!m)return!1;k=b[1].search("="),k>=0?(l=b[1].substring(0,k),h=b[1].substr(k+1),l!="regex"&&(h=isNaN(h)?h:parseInt(h),/^('|")\w+/.test(h)&&(h=h.replace(/^('|")|('|")$/g,"").split("|")))):(l=b[1],h=undefined),j={name:p,obj:m,rule:l,ruleExt:h!==!1?h:"",msg:b[2]||""},f.ruleData.push(j),f.options.timely&&function(a){m.length>0?m.tagName=="SELECT"?function(){g.bind(m,"change",function(){f.checkSingle(a,!0),f.checkError(a)},a.rule)}():function(){for(var d=0;d<m.length;d+=1)(function(c){g.bind(m[c],"click",function(){f.checkSingle(a,!0),f.checkError(a)},a.rule)})(d)}():(g.bind(m,"focus",function(){f.hideError(a.name)},a.rule),g.bind(m,"blur",function(){f.checkSingle(a,!0),f.checkError(a)},a.rule))}(j)},i.fn.checkForm=function(){var a=this;return a.errorHash={},a.errorArray=[],a.hideError(),g.each(a.ruleData,function(c,d){if(a.options.together)a.checkSingle(d);else{if(!(a.errorArray.length<1))return!1;a.checkSingle(d)}}),a.errorArray.length>0?!0:!1},i.fn.checkSingle=function(a,b){var f=this;if(!w.call(f,a)){if(!f.errorHash[a.name]){var k=f.errorArray.push(a);f.errorHash[a.name]=k}}else{var l=!1,k=f.errorHash[a.name];b&&k>0&&g.each(f.errorArray,function(c,d){if(d["name"]==a.name&&f.errorArray[c]["rule"]==a.rule)return f.errorArray.splice(c,1),f.errorHash[a.name]=!1,!1})}},i.fn.showError=function(){var a=this,b=[],f;if(typeof a.options.errShow=="function")a.options.errShow(a.errorArray);else switch(a.options.errShow){case"alert":case"multiple":g.each(a.errorArray,function(c,d){typeof d.msg=="string"?b.push(d.msg):typeof d.msg=="function"&&d.msg()}),a.options.errShow=="alert"?b.length>0&&alert(b.join("\n")):a.showErrorBox(a.formobj,b.join("<br/>"));break;case"single":g.each(a.errorArray,function(c,d){typeof d.msg=="string"?a.showErrorSingle(d):typeof d.msg=="function"&&d.msg()})}},i.fn.showErrorSingle=function(c){var d=this,a=c.obj,b=c.msg,f=c.name;d.errObjList[f]||(a.tagName!="SELECT"&&a.length&&(a=a[a.length-1]),a=g.getParent(a,d.options.errPar.toUpperCase()),d.errObjList[f]=g.getErrBox(a,"span",d.options.errBox)),typeof b=="string"?g.addMsg(d.errObjList[f],b):typeof b=="function"&&b()},i.fn.showErrorBox=function(c,d){var a=this,b=c.parentNode.getElementsByTagName("div");if(a.errGlobalObj)a.errGlobalObj.innerHTML=d,a.errGlobalObj.style.display="block";else{for(var f=0;f<b.length;f+=1)if(g.hasClass(b[f],a.options.errBox))return a.errGlobalObj=b[f],g.addMsg(a.errGlobalObj,d),!1;a.errGlobalObj||(a.errGlobalObj=document.createElement("div"),a.errGlobalObj.className=a.options.errBox,a.errGlobalObj.innerHTML=d,a.errGlobalObj.style.display="block",g.insertAfter(a.errGlobalObj,c))}},i.fn.checkError=function(a){var b=this,f=b.errorHash[a.name];b.errGlobalObj&&(b.errGlobalObj.style.display="none"),f>0?g.each(b.errorArray,function(c,d){if(d["name"]==a.name&&b.errorArray[c]["rule"]==a.rule)return b.showErrorSingle(b.errorArray[c]),!1}):b.hideError(a.name)},i.fn.hideError=function(a){var b=this;if(a)return b.errObjList[a]&&(b.errObjList[a].style.display="none"),!1;b.errGlobalObj&&(b.errGlobalObj.style.display="none"),b.errObjList&&g.each(b.errObjList,function(c,d){d.style.display="none"})};var w=function(b){var f=b.rule;switch(f){case"regex":return eval(b.ruleExt).test(b.obj.value);case"required":return g.isEmpty(b.obj.value)?!1:!0;case"maxlength":return g.isEmpty(b.obj.value)?!0:b.obj.value.length<=b.ruleExt;case"minlength":return g.isEmpty(b.obj.value)?!0:b.obj.value.length>=b.ruleExt;case"number":return g.isEmpty(b.obj.value)?!0:/^[\d]+$/.test(b.obj.value);case"alpha":return g.isEmpty(b.obj.value)?!0:/^[A-Za-z]+$/.test(b.obj.value);case"string":return g.isEmpty(b.obj.value)?!0:/^\w+$/.test(b.obj.value);case"email":return g.isEmpty(b.obj.value)?!0:/\w+((-w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+/.test(b.obj.value);case"telephone":return g.isEmpty(b.obj.value)?!0:/^[+]{0,1}(\d){1,3}[ ]?([-]?((\d)|[ ]){1,12})+$/.test(b.obj.value);case"mobile":return g.isEmpty(b.obj.value)?!0:/^0?1(3|4|5|8)\d{9}$/.test(b.obj.value);case"url":var k=/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;return k.test(b.obj.value);case"lessthan":case"greaterthan":var l=typeof b.ruleExt=="number"?b.ruleExt:parseInt(this.formobj[b.ruleExt].value);return f=="lessthan"?parseInt(b.obj.value)<l:parseInt(b.obj.value)>l;case"equal":case"unequal":var h=b.obj.value,p=b.ruleExt,m=this;return typeof p=="number"?function(){return f=="equal"?parseInt(h)==p:parseInt(h)!=p}():function(){return p.constructor===Array?f=="equal"?g.inArray(h,p):!g.inArray(h,p):f=="equal"?h==m.formobj[p].value:h!=m.formobj[p].value}();case"notselect":return b.obj.tagName=="SELECT"?function(){var c=b.obj.selectedIndex;return b.obj.options[c].value!=b.ruleExt}():function(){var c=b.obj,d=!0;if(c.length){if(b.ruleExt&&b.ruleExt.constructor===Array){q=b.ruleExt.length;for(var a=0;a<c.length;a+=1)if(c[a].checked==1&&g.inArray(c[a].value,b.ruleExt))return d=!1,!1}else for(var a=0;a<c.length;a+=1)if(c[a].checked==1){if(b.ruleExt===undefined)return d=!1,!1;if(c[a].value==b.ruleExt)return d=!1,!1}}else c.checked==1&&(d=!1);return d}();case"shouldselect":var j=b.obj,s=!1,q=0,v=0;if(j.length)if(b.ruleExt&&b.ruleExt.constructor===Array){q=b.ruleExt.length;for(var o=0;o<j.length;o+=1)j[o].checked==1&&g.inArray(j[o].value,b.ruleExt)&&(v+=1);s=q===v?!0:!1}else for(var o=0;o<j.length;o+=1)j[o].checked==1&&(b.ruleExt===undefined?s=!0:j[o].value==b.ruleExt&&(s=!0));else j.checked==1&&(s=!0);return s;case"minselect":case"maxselect":var j=b.obj,q=0;if(j.length)for(var o=0;o<j.length;o+=1)j[o].checked==1&&(q+=1);else j.checked==1&&(q+=1);return f=="minselect"?q>=b.ruleExt:q<=b.ruleExt;default:return!1}};window.Validator=i})()